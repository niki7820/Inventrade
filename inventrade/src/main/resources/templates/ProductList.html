<div th:fragment="productList">
    <div class="d-flex justify-content-end mb-3">
        <a href="#" id="addProductBtn" class="btn btn-primary">
            + Add Product
        </a>
    </div>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>ID</th><th>Name</th><th>HSN</th><th>Price</th>
            <th>Brand</th><th>Description</th><th>Status</th><th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
            <td th:text="${product.id}"></td>
            <td th:text="${product.name}"></td>
            <td th:text="${product.HSN}"></td>
            <td th:text="${product.price}"></td>
            <td th:text="${product.brand}"></td>
            <td th:text="${product.desc}"></td>
            <td th:text="${product.status}"></td>
            <td>
                <a href="#" class="btn btn-warning btn-sm edit-btn" th:data-id="${product.id}">Edit</a>
                <a href="#" class="btn btn-danger btn-sm delete-btn" th:data-id="${product.id}">Delete</a>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(products)}">
            <td colspan="8" class="text-center">No products found</td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    // Use delegated event for dynamically loaded content
    // Delegated event for dynamically loaded buttons
    $(document).on("click", "#addProductBtn", function (e) {
        e.preventDefault();
        $("#contentArea").load("/productadd"); // or add form fragment
    });

    $(document).on("click", ".delete-btn", function(e) {
        e.preventDefault();

        const id = $(this).data("id"); // get product id
        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        if (!confirm("Are you sure you want to delete this product?")) {
            return; // stop if user cancels
        }

        $.ajax({
            url: "/products/delete/" + id, // match your controller
            type: "POST", // Spring expects POST (not DELETE if that's your mapping)
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function() {
                // reload the product list fragment only
                $("#contentArea").load("/products/list :: productList");
            },
            error: function() {
                console.error("Delete failed");
            }
        });
    });



</script>


